---
layout: post
title: "Optimization of Stack and Heap"
date: 2025-12-02 12:00:00 +0900
author: kang
categories: [Optimization, Stack and Heap]
tags: [Optimization, Stack, Heap]
pin: false
math: true
mermaid: true
---

# What a difference of Stack and Heap memory
- In computer memory, It provides stack and heap memory for programming. Especailly for optimization it is very important part. If there are many time of cycle, what kind of memory we chose will effect to performance.

Let's check the Heap and stack of allocate and deallocate speed

â–½ Compare with heap and stack, Build enviroment Release/x64
```cpp
#include <iostream>
#include <chrono>
using namespace std;
using namespace std::chrono;

static const int N = 1000000;

int main() {
    volatile int i32PreventingOptimzation = 0;

    // --- Stack Allocation ---
    auto start1 = high_resolution_clock::now();
    for (int i = 0; i < 10000000; i++) 
    {
        int arr[N];

        arr[0] = i;
        i32PreventingOptimzation += i;
    }
    auto end1 = high_resolution_clock::now();
    auto stack_time = duration_cast<milliseconds>(end1 - start1).count();


    // --- Heap Allocation ---
    auto start2 = high_resolution_clock::now();
    for (int i = 0; i < 10000000; i++) 
    {
        int* arr = new int[N];
        arr[0] = i;
        i32PreventingOptimzation += i;
        delete[] arr;
    }
    auto end2 = high_resolution_clock::now();
    auto heap_time = duration_cast<milliseconds>(end2 - start2).count();

    cout << "Stack time: " << stack_time << " ms\n";
    cout << "Heap time:  " << heap_time << " ms\n";

    return 0;
}
```
> Result 

![Stack, Heap Test](/assets/img/develop/2025-12-02-Stack,Heap.jpg)

The differnece is over 10K times. In the other word, it is critical problem somtimes if we use frequently ALLOCATE and DEALLOCATE.

So we can think we should use only stack not heap. But why don't we use heap?

> Feature of STACK  

    - Size of memory is very small (depend on OS, 1MB ~ 8MB)
    - when we finish a function, it will be deallocated even we want.
    - If we use stack too much, it makes stack overflow

> Feature of HEAP

    - size of memory is very big (over GigaByte, the limit is depended on RAM memory)
    - The lifetime of allocatation is managed by developer
    - If we can't manage the allocate/deallocate, it makes memory leak or fragmentation
    - Especailly if HEAP CORRUPTION happens, it is not easy to find where part makes this.
    - The managing of heap is NOT EASY, so we should consider the design for maintaining stablility.


### The stack is a fast, automatically managed LIFO memory used for local variables and function calls, while the heap is a large, dynamically managed memory region that requires manual allocation and deallocation and is more prone to fragmentation and corruption.